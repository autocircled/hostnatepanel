<?php use WHMCS\Billing\Invoice;if(!defined("WHMCS")){die("This file cannot be accessed directly");}function gatewaymodule_MetaData(){return array('DisplayName'=>'FastSpring','APIVersion'=>'1.1','DisableLocalCredtCardInput'=>true,'TokenisedStorage'=>false,);}function fastspring_config(){return array('FriendlyName'=>array('Type'=>'System','Value'=>'FastSpring',),'storefront'=>array('FriendlyName'=>'Storefront','Type'=>'text','Size'=>'25','Default'=>'','Description'=>'Go FastSpring Storefronts->Popup Storefronts-> PLACE ON YOUR WEBSITE-> domain.onfastspring.com/popup-domain Copy and paste here',),'accessKey'=>array('FriendlyName'=>'Access Key','Type'=>'text','Size'=>'25','Default'=>'','Description'=>'FastSping dashboard under Integrations > Store Builder Library where you can also obtain the Access Key to enter below.',),'privateKey'=>array('FriendlyName'=>'Private Key','Type'=>'textarea','Rows'=>'3','Cols'=>'60','Description'=>'FastSping dashboard under Integrations > Store Builder Library ##SBL documentation. How to generate public key and private key',),'apiUsername'=>array('FriendlyName'=>'API Username','Type'=>'text','Size'=>'25','Default'=>'','Description'=>'FastSping dashboard under Integrations > API Credentials',),'apiPassword'=>array('FriendlyName'=>'API Password','Type'=>'password','Size'=>'25','Default'=>'','Description'=>'FastSping dashboard under Integrations > API Credentials',),'product_path_sub'=>array('FriendlyName'=>'Product Path Subscriptions','Type'=>'text','Size'=>'25','Default'=>'','Description'=>'Must be a Product path FastSping dashboard under Products->Subscriptions like path name: product-subscriptions',),'product_path'=>array('FriendlyName'=>'Product Path One Time','Type'=>'text','Size'=>'25','Default'=>'','Description'=>'Must be a Product path FastSping dashboard under Products->Product like path name: product-onetime-payment',),'gt_fees'=>array('FriendlyName'=>'Gateway Fees','Type'=>'text','Size'=>'5','Default'=>'','Description'=>'Optional field, if you need charge getway fees',),);}function fastspring_link($params){$storefront=$params['storefront'];$accessKey=$params['accessKey'];$privateKey=$params['privateKey'];$testMode=$params['testMode'];$invoiceId=$params['invoiceid'];$amount=$params['amount'];$invoice_Billing=Invoice::find($params['invoiceid'])->getBillingValues()[0];$rcUnite=$invoice_Billing['recurringCycleUnits'];$rcPeriod=$invoice_Billing['recurringCyclePeriod'];$firstname=$params['clientdetails']['firstname'];$lastname=$params['clientdetails']['lastname'];$email=$params['clientdetails']['email'];$phone=$params['clientdetails']['phonenumber'];$companyName=$params['companyname'];$systemUrl=$params['systemurl'];$returnUrl=$params['returnurl'];$langPayNow=$params['langpaynow'];$moduleDisplayName=$params['name'];$moduleName=$params['paymentmethod'];$whmcsVersion=$params['whmcsVersion'];$url='modules/gateways/fastspring/';$postfields=array();$postfields['invoice_id']=$invoiceId;$postfields['first_name']=$firstname;$postfields['last_name']=$lastname;$postfields['amount']=$amount;$postfields['email']=$email;$postfields['phone']=$phone;$postfields['companyname']=$companyName;$postfields['rcUnite']=$rcUnite;$postfields['rcPeriod']=$rcPeriod;$htmlOutput='<form method="post" action="'.$url.'">';foreach($postfields as $k=>$v){$htmlOutput.='<input type="hidden" name="'.$k.'" value="'.urlencode($v).'" />';}$htmlOutput.='<input class="btn" type="submit" value="'.$langPayNow.'" />';$htmlOutput.='</form>';return $htmlOutput;}