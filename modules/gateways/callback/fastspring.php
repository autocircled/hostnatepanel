<?php require_once __DIR__.'/../../../init.php';require_once __DIR__.'/../../../includes/gatewayfunctions.php';require_once __DIR__.'/../../../includes/invoicefunctions.php';$gatewayModuleName='fastspring';$gatewayParams=getGatewayVariables($gatewayModuleName);if(!$gatewayParams['type']){die("Module Not Activated");}$fsorder_id=$_POST['fsorder_id'];$credentials=$gatewayParams['apiUsername'].':'.$gatewayParams['apiPassword'];$url='https://api.fastspring.com/orders/'.$fsorder_id;$context=stream_context_create(array('http'=>array('user_agent'=>'Mozilla/5.0','header'=>"Authorization: Basic ".base64_encode($credentials)),));$dataSuccess=@json_decode(file_get_contents($url,false,$context));$fs_success=false;if($dataSuccess&&$dataSuccess->completed===true){$fs_success=true;}$success=$fs_success;$invoiceId=$_POST["invoice_id"];$transactionId=$dataSuccess->reference;$paymentAmount=$_POST["amount"];$paymentFee=$_POST["gt_fees"];$hash=$_POST["x_hash"];$transactionStatus=$success?'Success':'Failure';$invoiceId=checkCbInvoiceID($invoiceId,$gatewayParams['name']);checkCbTransID($transactionId);logTransaction($gatewayParams['name'],$_POST,$transactionStatus);if($success):addInvoicePayment($invoiceId,$transactionId,$paymentAmount,$paymentFee,$gatewayModuleName); ?><form action="<?php echo $gatewayParams['systemurl'].'viewinvoice.php'; ?>"id="PaymentSuccessFul"><input type="hidden"name="id"value="<?php echo $invoiceId; ?>"> <input type="hidden"name="paymentsuccess"value="true"></form><script>!function(){document.getElementById("PaymentSuccessFul").submit()}()</script><?php else: ?><form action="<?php echo $gatewayParams['systemurl'].'viewinvoice.php'; ?>"id="PaymentFailed"><input type="hidden"name="id"value="<?php echo $invoiceId; ?>"> <input type="hidden"name="paymentfailed"value="true"></form><script>!function(){document.getElementById("PaymentFailed").submit()}()</script><?php endif; ?>